<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>contract.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Contract.html">Contract</a><ul class='methods'><li data-type='method'><a href="Contract.html#.createValidator">createValidator</a></li><li data-type='method'><a href="Contract.html#.fromBuffer">fromBuffer</a></li><li data-type='method'><a href="Contract.html#.fromJSON">fromJSON</a></li><li data-type='method'><a href="Contract.html#.fromObject">fromObject</a></li><li data-type='method'><a href="Contract.html#toBuffer">toBuffer</a></li><li data-type='method'><a href="Contract.html#toJSON">toJSON</a></li><li data-type='method'><a href="Contract.html#toObject">toObject</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">contract.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

var assert = require('assert');
var merge = require('merge');
var time = require('ms');
var JSONSchema = require('jsen');

/**
 * Represents a storage contract
 * @constructor
 * @version 0
 * @param {Object} contract
 *
 */
function Contract(contract) {
  if (!(this instanceof Contract)) {
    return new Contract(contract);
  }

  this._properties = merge(Object.create(Contract.DEFAULTS), contract);
  this._validator = Contract.createValidator();

  assert.ok(
    this._validator(this._properties),
    'Invalid contract specification was supplied'
  );
}

/**
 * Defines the JSON Schema of a {@link Contract}
 * @static
 */
Contract.Schema = {
  type: 'object',
  properties: {
    version: {
      type: 'number'
    },
    duration: {
      type: 'array',
      items: [
        { type: 'number' },
        { type: 'number' }
      ]
    },
    shard_hash: {
      type: 'string',
      minLength: 64,
      maxLength: 64
    },
    shard_size: {
      type: 'number',
      minimum: 0
    },
    farmer: {
      type: 'array',
      minItems: 3,
      maxItems: 3,
      items: [
        { type: 'string' },
        { type: 'number' },
        { type: 'string' }
      ]
    },
    renter: {
      type: 'array',
      minItems: 3,
      maxItems: 3,
      items: [
        { type: 'string' },
        { type: 'number' },
        { type: 'string' }
      ]
    },
    payment_unit: {
      type: 'string',
      minLength: 3,
      maxLength: 4
    },
    payment_amount: {
      type: 'number',
      minimum: 0
    },
    payment_destination: {
      type: 'string',
      minLength: 26,
      maxLength: 35
    },
    payment_source: {
      type: 'string',
      minLength: 26,
      maxLength: 35
    },
    payment_download_price: {
      type: 'number',
      minimum: 0
    },
    payment_schedule: {
      type: 'array',
      minItems: 2,
      maxItems: 2,
      items: { type: 'number' }
    },
    audit_strategy: {
      type: 'string'
    },
    audit_schedule: {
      type: 'array',
      minItems: 2,
      maxItems: 2,
      items: { type: 'number' }
    }
  }
};

/**
 * Defines some default properties of a {@link Contract}
 * @static
 */
Contract.DEFAULTS = {
  version: 0,
  duration: [Date.now(), Date.now()],
  shard_hash: Array(65).join(0),
  shard_size: 0,
  farmer: ['0.0.0.0', 1337, '&lt;node_id>'],
  renter: ['0.0.0.0', 1337, '&lt;node_id>'],
  payment_unit: 'SJCX',
  payment_amount: 0,
  payment_destination: Array(27).join(0),
  payment_source: Array(27).join(0),
  payment_download_price: 0,
  payment_schedule: [time('30d'), 12],
  audit_strategy: '&lt;audit_identifier>',
  audit_schedule: [time('30d'), 12]
};

/**
 * Converts the contract to a plain object
 * @returns {Object}
 */
Contract.prototype.toObject = function() {
  return Object.create(this._properties);
};

/**
 * Converts the contract to JSON string
 * @returns {String}
 */
Contract.prototype.toJSON = function() {
  return JSON.stringify(this.toObject());
};

/**
 * Converts the contract to Buffer
 * @returns {Buffer}
 */
Contract.prototype.toBuffer = function() {
  return new Buffer(this.toJSON(), 'utf8');
};

/**
 * Creates a contract from a plain object
 * @param {Object} object
 * @returns {Contract}
 */
Contract.fromObject = function(object) {
  return new Contract(object);
};

/**
 * Creates a contract from a JSON string
 * @param {String} json
 * @returns {Contract}
 */
Contract.fromJSON = function(json) {
  return new Contract(JSON.parse(json));
};

/**
 * Creates a contract from a Buffer
 * @param {Buffer} buffer
 * @returns {Contract}
 */
Contract.fromBuffer = function(buffer) {
  return new Contract(JSON.parse(buffer.toString('utf8')));
};

/**
 * Creates a validator function for data against the schema
 * @returns {Function} validator
 */
Contract.createValidator = function() {
  return JSONSchema(Contract.Schema);
};

module.exports = Contract;
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Tue Feb 02 2016 16:31:13 GMT-0500 (EST) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
